<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>é¥¶ & æ¨ çš„ç”Ÿæ´»ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans SC', sans-serif; -webkit-tap-highlight-color: transparent; position: fixed; width: 100%; height: 100%; overflow: hidden; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .h-safe-screen { height: 100dvh; }
      
      /* åŠ¨ç”»å®šä¹‰ */
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      @keyframes scaleIn { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
      @keyframes overlayIn { from { opacity: 0; } to { opacity: 1; } }
      
      .fade-in { animation: fadeIn 0.4s ease-out forwards; }
      .scale-in { animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
      .overlay-in { animation: overlayIn 0.3s ease-out forwards; }
      
      .bottom-nav { 
        position: fixed; bottom: 0; left: 0; right: 0; 
        height: calc(60px + env(safe-area-inset-bottom)); 
        background: rgba(255,255,255,0.98); backdrop-filter: blur(20px); 
        border-top: 1px solid rgba(0,0,0,0.05); 
        display: flex; justify-content: space-around; align-items: center; 
        padding-bottom: env(safe-area-inset-bottom); z-index: 100; 
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div id="root" class="h-safe-screen w-full"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // åŸå§‹èœå•æ•°æ®
      const MENU_DATA = [
        { id: 99, name: 'é¥¶å“ç¥ºäº²è‡ªä¸‹å¨', price: 20, category: 'å¿…é€‰é¡¹', desc: 'åº—é•¿ç‰¹ä¾›ï¼Œä»Šæ—¥å¨è‰ºç²¾è¿›ä¸­', must: true },
        { id: 1, name: 'è¾£æ¤’ç‚’è‚‰', price: 18, category: 'çƒ­èœ', desc: 'é²œå«©ä¸‹é¥­ï¼Œæ‹›ç‰Œå¿…ç‚¹' },
        { id: 2, name: 'å¯ä¹é¸¡ç¿…', price: 18, category: 'çƒ­èœ', desc: 'ç”œå’¸é€‚ä¸­ï¼Œçš®ç³¯è‚‰é¦™' },
        { id: 3, name: 'å¯ä¹é¸¡è…¿', price: 15, category: 'çƒ­èœ', desc: 'è‚‰è´¨åšå®ï¼Œæ±æ°´ä¸°å¯Œ' },
        { id: 4, name: 'ç•ªèŒ„ç‚’é¸¡è›‹', price: 12, category: 'çƒ­èœ', desc: 'ç»å…¸ç¾å‘³ï¼Œè€å°‘çš†å®œ' },
        { id: 5, name: 'æ°´ç…®ç‰›è‚‰', price: 25, category: 'çƒ­èœ', desc: 'éº»è¾£é²œé¦™ï¼Œå£æ„Ÿæ»‘å«©' },
        { id: 6, name: 'è¾£æ¤’ç‚’é¸¡è›‹', price: 12, category: 'çƒ­èœ', desc: 'ç®€å•çš„é¦™è¾£ç¾å‘³' },
        { id: 7, name: 'æ°´è’¸è›‹', price: 8, category: 'çƒ­èœ', desc: 'å£æ„Ÿæ»‘å«©ï¼Œå…¥å£å³åŒ–' },
        { id: 8, name: 'è¥¿å…°èŠ±ç‚’è™¾ä»', price: 22, category: 'çƒ­èœ', desc: 'æ¸…çˆ½è¥å…»ï¼Œè™¾ä»Qå¼¹' },
        { id: 9, name: 'å—æ˜Œæ‹Œç²‰', price: 8, category: 'ä¸»é£Ÿ', desc: 'åœ°é“å®¶ä¹¡å‘³ï¼Œé…èœè¶³' },
        { id: 10, name: 'å—æ˜Œç‚’ç²‰', price: 12, category: 'ä¸»é£Ÿ', desc: 'é”…æ°”åè¶³ï¼Œé¦™è¾£çˆ½å£' },
        { id: 11, name: 'é¦’å¤´', price: 2, category: 'ä¸»é£Ÿ', desc: 'æ¾è½¯æ‰‹å·¥å¤§é¦’å¤´' },
        { id: 12, name: 'é¢æ¡', price: 6, category: 'ä¸»é£Ÿ', desc: 'çƒ­è…¾è…¾çš„éª¨æ±¤é¢' },
        { id: 13, name: 'é¥ºå­', price: 12, category: 'ä¸»é£Ÿ', desc: 'çš®è–„é¦…å¤§æ‰‹å·¥æ°´é¥º' },
        { id: 14, name: 'æ±¤åœ†', price: 8, category: 'ä¸»é£Ÿ', desc: 'èŠéº»æµå¿ƒï¼Œç”œèœœæ¸©æš–' },
        { id: 15, name: 'æ³¡é¢', price: 5, category: 'ä¸»é£Ÿ', desc: 'æ·±å¤œé£Ÿå ‚åŒæ¬¾' },
        { id: 16, name: 'ç±³é¥­', price: 2, category: 'ä¸»é£Ÿ', desc: 'ç²¾é€‰äº”å¸¸å¤§ç±³' },
        { id: 17, name: 'å¯ä¹', price: 4, category: 'é¥®å“', desc: 'å†°é•‡å¿«ä¹æ°´' },
        { id: 18, name: 'çŸ¿æ³‰æ°´', price: 2, category: 'é¥®å“', desc: 'å¤©ç„¶ç”˜æ³‰' },
        { id: 19, name: 'å¼€æ°´', price: 0, category: 'é¥®å“', desc: 'æš–èƒƒå…è´¹' }
      ];

      // æ„¿æœ›å•†åº—æ•°æ®
      const WISH_DATA = [
        { id: 'w1', name: 'å……ç”µä¸€æ¬¡', price: 100, category: 'æ ¸å¿ƒ', icon: 'ğŸ”‹', desc: 'åŸºç¡€å……ç”µèƒ½é‡è¡¥å……' },
        { id: 'w1_sub1', name: 'â”” é™„åŠ ï¼šæˆ˜è¢è‡ªé€‰', price: 50, category: 'æ ¸å¿ƒ', icon: 'ğŸ‘—', desc: 'æŒ‡å®šä»Šæ—¥ç‰¹åˆ«ç©¿æ­' },
        { id: 'w1_sub2', name: 'â”” é™„åŠ ï¼šåƒç³– 10åˆ†é’Ÿ', price: 50, category: 'æ ¸å¿ƒ', icon: 'ğŸ¬', desc: 'ç”œèœœäº’åŠ¨æ—¶é—´' },
        { id: 'w2', name: 'æŒ‰æ‘© 10åˆ†é’Ÿ', price: 30, category: 'æœåŠ¡', icon: 'ğŸ’†â€â™‚ï¸', desc: 'èˆ’ç¼“ç–²åŠ³ï¼Œæ‰‹æ³•ä¸“ä¸š' },
        { id: 'w3', name: 'æ´—ç¢—ç‰¹æƒ', price: 100, category: 'æœåŠ¡', icon: 'ğŸ§¼', desc: 'ä»Šæ—¥ç¢—ç­·ç”±æ¨å¥³å£«æ‰¿åŒ…' },
        { id: 'w4', name: 'å…æ­»é‡‘ç‰Œ', price: 150, category: 'ç‰¹æƒ', icon: 'ğŸ›¡ï¸', desc: 'åŒ–è§£ä¸€æ¬¡å†²çªæˆ–å…é™¤ä»»åŠ¡' },
        { id: 'w5', name: 'å¤§å¥–ï¼šå…¨å¤©å¬è¯', price: 500, category: 'ç»ˆæ', icon: 'ğŸ†', desc: '24å°æ—¶ç»å¯¹æœä»æŒ‡ä»¤' }
      ];

      // --- æ–°å¢ï¼šç¾åŒ–å¼¹çª—ç»„ä»¶ ---
      function Modal({ visible, title, content, onConfirm, onCancel, type = 'info' }) {
        if (!visible) return null;
        const isConfirm = !!onCancel;
        return (
          <div className="fixed inset-0 z-[200] flex items-center justify-center px-6 overlay-in">
            <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={onCancel || onConfirm}></div>
            <div className="bg-white w-full max-w-sm rounded-[32px] p-8 shadow-2xl relative z-10 scale-in border border-slate-100">
              <div className="flex flex-col items-center text-center">
                <div className={`w-16 h-16 rounded-2xl flex items-center justify-center text-3xl mb-4 ${
                  type === 'success' ? 'bg-green-50 text-green-500' : 
                  type === 'shop' ? 'bg-orange-50 text-orange-500' : 'bg-slate-50 text-slate-500'
                }`}>
                  {type === 'success' ? 'âœ…' : type === 'shop' ? 'ğŸ' : 'ğŸ’¡'}
                </div>
                <h3 className="text-xl font-black text-slate-800 mb-2">{title}</h3>
                <p className="text-slate-400 text-sm leading-relaxed mb-8">{content}</p>
                <div className="flex gap-3 w-full">
                  {isConfirm && (
                    <button onClick={onCancel} className="flex-1 h-14 rounded-2xl font-bold text-slate-400 bg-slate-50 active:scale-95 transition-all">å–æ¶ˆ</button>
                  )}
                  <button onClick={onConfirm} className={`flex-1 h-14 rounded-2xl font-bold text-white shadow-lg active:scale-95 transition-all ${
                    type === 'shop' ? 'bg-slate-900 shadow-slate-200' : 'bg-red-600 shadow-red-100'
                  }`}>ç¡®å®š</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        const [tab, setTab] = useState('restaurant');
        const [step, setStep] = useState('welcome');
        const [cart, setCart] = useState({});
        const [activeCat, setActiveCat] = useState('å¿…é€‰é¡¹');
        const [totalPoints, setTotalPoints] = useState(() => parseInt(localStorage.getItem('rpq_points') || '0'));

        // å¼¹çª—çŠ¶æ€
        const [modal, setModal] = useState({ visible: false, title: '', content: '', onConfirm: null, onCancel: null, type: 'info' });

        useEffect(() => { localStorage.setItem('rpq_points', totalPoints); }, [totalPoints]);

        const currentTotal = Object.keys(cart).reduce((sum, id) => sum + (MENU_DATA.find(m => m.id == id).price * cart[id]), 0);
        const hasMust = Object.keys(cart).some(id => MENU_DATA.find(m => m.id == id).must);

        const showModal = (config) => setModal({ visible: true, ...config });
        const closeModal = () => setModal({ ...modal, visible: false });

        const handleCheckout = () => {
          showModal({
            title: 'ç¡®è®¤ä¸‹å•å—ï¼Ÿ',
            content: `æœ¬æ¬¡åšé¥­å°†ä¸ºä½ å¢åŠ  ${currentTotal} ç§¯åˆ†ï¼ŒChef è¾›è‹¦å•¦ï¼`,
            type: 'success',
            onConfirm: () => {
              setTotalPoints(totalPoints + currentTotal);
              setCart({});
              closeModal();
            },
            onCancel: closeModal
          });
        };

        const handleRedeem = (wish) => {
          if (totalPoints < wish.price) {
            showModal({ title: 'ç§¯åˆ†ä¸è¶³', content: 'å¿«å»åšé¥­èµšç‚¹åˆ†å§ï¼Œè¿˜å·®ä¸€ç‚¹ç‚¹å“¦ï½', onConfirm: closeModal });
            return;
          }
          showModal({
            title: 'ç¡®è®¤å…‘æ¢ï¼Ÿ',
            content: `ç¡®å®šæ¶ˆè€— ${wish.price} ç§¯åˆ†å…‘æ¢ã€${wish.name}ã€‘å—ï¼Ÿ`,
            type: 'shop',
            onConfirm: () => {
              setTotalPoints(totalPoints - wish.price);
              closeModal();
              setTimeout(() => {
                showModal({ title: 'å…‘æ¢æˆåŠŸ', content: `è¯·å‡­æ­¤è®°å½•æ‰¾æ¨å¥³å£«é¢†å–å¥–åŠ±ï¼š${wish.name}`, type: 'success', onConfirm: closeModal });
              }, 400);
            },
            onCancel: closeModal
          });
        };

        if (step === 'welcome') return (
          <div className="h-full bg-slate-900 flex flex-col items-center justify-center text-white p-6 fade-in relative overflow-hidden">
            <div className="absolute top-[-10%] left-[-10%] w-64 h-64 bg-red-500 rounded-full blur-3xl opacity-10"></div>
            <div className="text-8xl mb-8 animate-bounce text-red-500">â¤ï¸</div>
            <h1 className="text-3xl font-black mb-2 text-center tracking-tight">é¥¶ & æ¨ çš„ç”Ÿæ´»ç³»ç»Ÿ</h1>
            <p className="text-slate-500 text-xs mb-12 tracking-[0.3em] uppercase italic text-center">Love & Efficiency Management</p>
            <button onClick={() => setStep('main')} className="bg-white text-slate-900 px-14 py-4 rounded-2xl font-black shadow-2xl active:scale-95 transition-all relative z-10">ç‚¹å‡»è¿›å…¥ç³»ç»Ÿ</button>
          </div>
        );

        return (
          <div className="h-full flex flex-col bg-slate-50">
            <Modal {...modal} />
            <div className="flex-1 overflow-hidden relative">
              {tab === 'restaurant' ? (
                <div className="h-full flex flex-col fade-in">
                  <header className="p-6 pt-12 bg-white flex justify-between items-end shadow-sm z-10">
                    <div>
                      <h1 className="text-2xl font-black text-slate-800 tracking-tighter">åšé¥­èµšåˆ†</h1>
                      <p className="text-[10px] text-green-500 font-bold uppercase tracking-widest mt-1">Chef: Rao Pinqi</p>
                    </div>
                    <div className="bg-slate-900 text-white px-4 py-2 rounded-2xl text-center">
                      <p className="text-[9px] opacity-60 font-bold uppercase leading-tight">Total Points</p>
                      <p className="text-xl font-black mt-0.5">{totalPoints}</p>
                    </div>
                  </header>

                  <div className="flex flex-1 overflow-hidden mt-1">
                    <div className="w-20 bg-slate-100 flex flex-col pt-4 overflow-y-auto no-scrollbar">
                      {['å¿…é€‰é¡¹', 'çƒ­èœ', 'ä¸»é£Ÿ', 'é¥®å“'].map(cat => (
                        <button key={cat} onClick={() => setActiveCat(cat)} 
                          className={`w-full py-5 text-xs font-bold transition-all ${activeCat === cat ? 'text-red-600 bg-white shadow-sm' : 'text-slate-400'}`}>
                          {cat}
                        </button>
                      ))}
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 bg-white rounded-tl-[32px] no-scrollbar pb-[240px]">
                      {MENU_DATA.filter(i => i.category === activeCat).map(item => (
                        <div key={item.id} className="flex gap-4 mb-6 p-1">
                          <div className="w-14 h-14 bg-slate-50 rounded-xl flex items-center justify-center text-2xl shadow-inner border border-slate-50">
                            {item.category === 'é¥®å“' ? 'ğŸ¥¤' : item.category === 'ä¸»é£Ÿ' ? 'ğŸš' : 'ğŸ¥˜'}
                          </div>
                          <div className="flex-1">
                            <h3 className="font-bold text-sm text-slate-800">{item.name}</h3>
                            <p className="text-[10px] text-slate-400 line-clamp-1 italic">{item.desc}</p>
                            <div className="flex justify-between items-center mt-2">
                              <span className="text-red-600 font-black text-sm">+{item.price}</span>
                              <div className="flex items-center gap-3">
                                {cart[item.id] > 0 && <button onClick={() => {
                                  let newCart = {...cart};
                                  newCart[item.id]--;
                                  if(newCart[item.id] <= 0) delete newCart[item.id];
                                  setCart(newCart);
                                }} className="w-7 h-7 border border-slate-200 rounded-lg flex items-center justify-center text-slate-400">-</button>}
                                {cart[item.id] > 0 && <span className="text-sm font-black text-slate-700">{cart[item.id]}</span>}
                                <button onClick={() => setCart({...cart, [item.id]: (cart[item.id] || 0) + 1})} className="w-7 h-7 bg-slate-900 text-white rounded-lg flex items-center justify-center shadow-md active:scale-90 transition-transform">+</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  {currentTotal > 0 && (
                    <div className="absolute bottom-[85px] left-0 right-0 flex justify-center px-6 z-[60] fade-in">
                      <button onClick={handleCheckout} disabled={!hasMust}
                        className={`w-auto min-w-[220px] h-14 px-10 rounded-full font-black text-white shadow-[0_20px_40px_rgba(220,38,38,0.3)] transition-all ${hasMust ? 'bg-red-600 active:scale-95' : 'bg-slate-300'}`}>
                        {hasMust ? `ç¡®è®¤ä¸‹å• (+${currentTotal} ç§¯åˆ†)` : 'è¯·å‹¾é€‰å¿…é€‰é¡¹'}
                      </button>
                    </div>
                  )}
                </div>
              ) : (
                <div className="h-full flex flex-col fade-in">
                  <header className="p-6 pt-12 bg-white flex justify-between items-end shadow-sm">
                    <div>
                      <h1 className="text-2xl font-black text-slate-800 tracking-tighter">æ„¿æœ›å•†åº—</h1>
                      <p className="text-[10px] text-blue-500 font-bold uppercase tracking-widest mt-1">Buyer: Rao Pinqi</p>
                    </div>
                    <div className="bg-red-500 text-white px-4 py-2 rounded-2xl text-center">
                      <p className="text-[9px] opacity-60 font-bold uppercase leading-tight">Points Left</p>
                      <p className="text-xl font-black mt-0.5">{totalPoints}</p>
                    </div>
                  </header>
                  <div className="flex-1 overflow-y-auto p-6 no-scrollbar pb-32">
                    {WISH_DATA.map(wish => (
                      <div key={wish.id} className={`bg-white rounded-[32px] p-5 mb-4 shadow-sm border border-slate-100 flex items-center gap-4 ${wish.name.includes('â””') ? 'ml-6 opacity-90 scale-95 border-l-2 border-l-red-100' : ''}`}>
                        <div className="text-3xl">{wish.icon}</div>
                        <div className="flex-1">
                          <h3 className="font-bold text-slate-800 text-sm">{wish.name}</h3>
                          <p className="text-[10px] text-slate-400 mt-1">{wish.desc}</p>
                          <div className="flex justify-between items-center mt-3">
                            <span className="text-red-500 font-black text-sm">-{wish.price} <span className="text-[9px]">PTS</span></span>
                            <button onClick={() => handleRedeem(wish)} className={`px-4 py-2 rounded-xl text-[10px] font-black transition-all ${totalPoints >= wish.price ? 'bg-slate-900 text-white shadow-md active:scale-95' : 'bg-slate-100 text-slate-300'}`}>
                              ç«‹å³å…‘æ¢
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            <nav className="bottom-nav">
              <button onClick={() => setTab('restaurant')} className={`flex flex-col items-center gap-1 transition-all ${tab === 'restaurant' ? 'text-red-600 scale-105' : 'text-slate-300'}`}>
                <span className="text-xl">ğŸ³</span>
                <span className="text-[10px] font-black uppercase">åšé¥­èµšåˆ†</span>
              </button>
              <button onClick={() => setTab('shop')} className={`flex flex-col items-center gap-1 transition-all ${tab === 'shop' ? 'text-red-600 scale-105' : 'text-slate-300'}`}>
                <span className="text-xl">ğŸ</span>
                <span className="text-[10px] font-black uppercase">æ„¿æœ›å•†åº—</span>
              </button>
            </nav>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
